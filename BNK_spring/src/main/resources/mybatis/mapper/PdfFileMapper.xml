<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.busanbank.card.admin.dao.PdfFileMapper">

	<!-- 업로드 -->
	<insert id="insertPdfFile"
		parameterType="com.busanbank.card.admin.dto.PdfFile">
		<selectKey keyProperty="pdfNo" resultType="long"
			order="BEFORE">
			SELECT pdf_files_seq.NEXTVAL FROM dual
		</selectKey>

		INSERT INTO pdf_files (
		pdf_no, pdf_name, pdf_data, is_active, upload_date, admin_no
		)
		VALUES (
		#{pdfNo}, #{pdfName}, #{pdfData}, #{isActive}, SYSDATE, #{adminNo,
		jdbcType=NUMERIC}
		)
	</insert>

	<!-- 조회 (관리자 이름은 포함 X) -->
	<select id="selectAllPdfFiles"
		resultType="com.busanbank.card.admin.dto.PdfFile">
		SELECT
		p.pdf_no,
		p.pdf_name,
		p.pdf_data,
		p.is_active,
		p.upload_date,
		p.admin_no,
		a.name AS adminName  <!-- 관리자 이름 조인 -->
		FROM pdf_files p
		JOIN admin a ON p.admin_no = a.admin_no
		ORDER BY p.upload_date DESC
	</select>

	<!-- 수정 -->
	<update id="updatePdf">
		UPDATE pdf_files
		SET
		pdf_name = #{pdfName},
		is_active = #{isActive}
		WHERE pdf_no = #{pdfNo}
	</update>

	<!-- 삭제 -->
	<delete id="deletePdf">
		DELETE FROM pdf_files
		WHERE pdf_no = #{pdfNo}
	</delete>

</mapper>
